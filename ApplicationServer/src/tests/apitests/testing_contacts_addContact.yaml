---
- config:
    - testset: "Testing contacts url - add contact"

- test:
    - name: "Get contacts - before"
    - url: "/contacts/1"
    - headers: {Authorization: tokenUser1}
    - method: "GET"
    - validators:
          - compare: {jsonpath_mini: "metadata.count", comparator: "eq", expected: 0}
    - expected_status: [200] # ok

- test:
    - name: "Add contact"
    - url: "/contacts"
    - headers: {Authorization: tokenUser1}
    - method: "PUT"
    - body: '{"author_id": 1, "contact_id": 2, "action": "add_contact"}'
    - expected_status: [200] # ok

- test:
    - name: "Get contacts - after - not accepted yet"
    - url: "/contacts/1"
    - headers: {Authorization: tokenUser1}
    - method: "GET"
    - validators:
          - compare: {jsonpath_mini: "contacts.0.id", comparator: "eq", expected: 2}
          - compare: {jsonpath_mini: "contacts.0.status", comparator: "eq", expected: "requested"}
          - compare: {jsonpath_mini: "metadata.count", comparator: "eq", expected: 1}
    - expected_status: [200] # ok

- test:
    - name: "Accept contact"
    - url: "/contacts"
    - headers: {Authorization: tokenUser2}
    - method: "PUT"
    - body: '{"author_id": 2, "contact_id": 1, "action": "accept_contact"}'
    - expected_status: [200] # ok

- test:
    - name: "Get contacts - after - accepted"
    - url: "/contacts/1"
    - headers: {Authorization: tokenUser1}
    - method: "GET"
    - validators:
          - compare: {jsonpath_mini: "contacts.0.id", comparator: "eq", expected: 2}
          - compare: {jsonpath_mini: "contacts.0.status", comparator: "eq", expected: "active"}
          - compare: {jsonpath_mini: "metadata.count", comparator: "eq", expected: 1}
    - expected_status: [200] # ok
